# クラウドファンディングスマートコントラクト

このリポジトリには、基本的なクラウドファンディングプラットフォーム用のSolidityスマートコントラクトが含まれています。ユーザーは、特定の資金目標と期限を設定してプロジェクトを作成し、プロジェクトへの寄付、資金の引き出し、目標未達成時の返金を行うことができます。

## 概要

`Crowdfunding`スマートコントラクトでは、次の操作が可能です：

- 資金目標と期限を設定してクラウドファンディングプロジェクトを作成。
- プロジェクトへの資金提供と寄付の追跡。
- プロジェクトが資金目標を達成した場合の資金の引き出し。
- プロジェクトが目標未達成の場合、寄付者への返金。

## コントラクトの構造

コントラクトは以下の主要なコンポーネントで構成されています：

1. **Project 構造体**：各クラウドファンディングプロジェクトの構造を定義。
   - `owner`: プロジェクトオーナーのアドレス。
   - `title`: プロジェクトのタイトル。
   - `description`: プロジェクトの説明。
   - `fundingGoal`: 資金調達の目標額。
   - `deadline`: プロジェクトの期限（Unixタイムスタンプ）。
   - `amountRaised`: プロジェクトで調達された総額。
   - `isFunded`: 資金目標が達成されたかを示すブール値。
   - `contributions`: 寄付者のアドレスと寄付額のマッピング。

2. **イベント**:
   - `ProjectCreated`: 新しいプロジェクトが作成されたときに発行されます。
   - `Funded`: ユーザーがプロジェクトに資金を提供したときに発行されます。
   - `FundWithdrawn`: プロジェクトオーナーが資金を引き出したときに発行されます。
   - `Refunded`: プロジェクトが失敗した際、寄付者が返金されたときに発行されます。

3. **修飾子 (Modifiers)**:
   - `onlyBeforeDeadline`: プロジェクト期限前のみアクションを許可。
   - `onlyOwner`: プロジェクトオーナーのみにアクションを許可。

## 関数

- `createProject(string memory _title, string memory _description, uint _fundingGoal, uint _durationInDays)`:  
  任意のユーザーが、タイトル、説明、資金目標、期間（日数）を指定して新しいプロジェクトを作成できます。

- `fundProject(uint _projectId)`:  
  特定のプロジェクトに資金を提供します。資金提供はプロジェクト期限前かつ資金目標未達成の場合にのみ受け付けられます。

- `withdrawFunds(uint _projectId)`:  
  資金目標が達成された場合、プロジェクトオーナーが資金を引き出せます。プロジェクトオーナーのみ実行可能です。

- `refund(uint _projectId)`:  
  プロジェクトが資金目標を期限内に達成できなかった場合、寄付者が返金を受けることができます。

- `getProject(uint _projectId)`:  
  特定のプロジェクトの詳細を取得します。詳細にはオーナー、タイトル、説明、資金目標、期限、調達額、資金調達の状況が含まれます。

- `getProjectCount()`:  
  プロジェクトの総数を取得します。

- `getContribution(uint _projectId, address _contributor)`:  
  特定の寄付者がプロジェクトに提供した金額を取得します。

## 使用方法

### 1. コントラクトのデプロイ

[Remix](https://remix.ethereum.org/)や[Hardhat](https://hardhat.org/)などの開発環境を使用して、Ethereumブロックチェーンにコントラクトをデプロイします。

### 2. プロジェクトの作成

`createProject`を呼び出し、プロジェクトのタイトル、説明、資金目標、期間（日数）を指定して新しいプロジェクトを作成します。`ProjectCreated`イベントが発行され、プロジェクトIDなどの詳細が確認できます。

### 3. プロジェクトへの資金提供

`fundProject`をプロジェクトIDとともに呼び出し、Etherを送金します。`Funded`イベントが発行され、寄付者と金額が表示されます。

### 4. 資金の引き出し

資金目標が達成されたら、プロジェクトオーナーは`withdrawFunds`を呼び出して調達資金を引き出せます。`FundWithdrawn`イベントが発行されます。

### 5. 返金のリクエスト

プロジェクトの期限が過ぎて資金目標を達成できなかった場合、寄付者は`refund`を呼び出して返金を受けることができます。`Refunded`イベントが発行されます。

## セキュリティの考慮事項

- **再入可能性攻撃対策**: Etherの送金前に状態更新（例：`amountRaised`）が行われているため、再入可能性攻撃への対策が施されています。
- **アクセス制御**: プロジェクトオーナーのみが資金を引き出せるように制御されています。
- **安全な送金方法**: 一部のアドレスでのガス制限問題を避けるため、`call`を使用してガス不足の問題を防止しています。

## テスト

以下の手順でコントラクトをテストできます：

1. **Remixでのテスト**: [Remix IDE](https://remix.ethereum.org/)を使ってコントラクトをデプロイし、インタラクションを確認します。
2. **Hardhatでのテスト**:
   - JavaScriptやTypeScriptでテストスクリプトを作成し、コントラクトとやり取りを行います。
   - Mochaやchaiなどのアサーションライブラリを使って、各関数が期待通りに動作するか確認します（例：寄付額の確認、引き出し、返金など）。

## ライセンス

このプロジェクトはMITライセンスのもとで提供されています。
